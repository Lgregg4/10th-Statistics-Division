---
title: "Lab 8"
author: "Lauren, Ryan, Katie, Chris"
date: "3/7/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Overall Question

Does a relationship exist between race (White, Black, Hispanic, Other) in some certain ages and leading causes of death? Futhermore, are these trends consistent across states, and which states have the highest percengate that people dead ?
This question proves relevant as an exploration into if race and ages can indicate liklihood of causes of death. For example, people think that race can act as clue to individuals risk of heart disease. Perhaps we will identify a relationship with heart disease and race within this dataset to support that claim. It is interesting to add the state component because each state has unique conditions that may impact other mortality factors.

This is especially interesting for our domain expert, the Census Bureau, because they are concerned with the general trends of mortality. 

# Conclusion

## Recommendation
(including why its important)

# Description of the Dataset

(Note: I wrote this based off of my tidy data, obvioulsy it can be changed.)

We have decided on a very large data set found on ____. We are focusing on the "Leading Causes of Death" tab. This data frame has aboout 230 attributes and over 3000 observations. The attributes include county, state, and causes of death ranging from birth defect to injury to cancer. 

We have tidied the data set and omitted unnecessary information. The data now has eight attributes (County Name, State Name, State Abbreviation, Cause of Death, Count, Time Span, Race, and Age Range) and 238,716 observations.

The attribute Cause of Death includes eight causes of death: pregnancy or birth complication, birth defect, injury, cancer, homicide, suicide, heart disease, and HIV. The age range is a range of ages that the data has been collected for and there are six groupings: under 1, 1-14, 15-24, 25-44, 45-64, and 65+. Race was divided into 4 groupings: white, black, hispanic, and other.

And based on the overall tidied data, for each individual, we created our own tidy data to explore our questions towards the cause of death. We selected some useful columns and combinded some datas to illustrate the tendency of the death for each state.

# Individual Findings

## Chris

## Katie
#Question:
 My interesting part is Which states of white people at age less than 1 dead due to Preg/Birth Complication have the highest death precentage? 
Knowing which range of age is the highest percentage death is very important.
Because due to the rapid development of our country, more people not only want to improve their life quality, but hope to have a longer healthy life. And those dead childen are the youngest, they need our protection and the attentions of the society.
Once we figure out the range that having highest dead chances and their reasons, we can take some actions to decrease the risk, in order to give people better lives. 
Hence, we want to pay more attention on why people dead, and in which range of ages people have the highest dead chances.

Based on our team tidy data, I modified some parts and made it accessible for me to explore the highest percentage of states. First, I tidied data by gathering all the white children who¡¯s age is less than one, and selected the columns that I want to explore. Because there are several races and year, so I modified them to separate columns.And now this tidy data only contains the reasons of death for age under one year old, which is what I need.
```{r}
library(tidyverse)
leading<- read.csv("LEADINGCAUSESOFDEATH.csv")
data1 <- leading %>% gather('A_Wh_Comp', 'A_Bl_Comp', 'A_Ot_Comp', 'A_Hi_Comp',
                         'A_Wh_BirthDef', 'A_Bl_BirthDef', 'A_Ot_BirthDef', 'A_Hi_BirthDef',key="Cause_of_Death_For_Age_less_than_1", value = "Count") %>%mutate()

data2 <- data1 %>% select(c(CHSI_County_Name, CHSI_State_Name, CHSI_State_Abbr,
                            Cause_of_Death_For_Age_less_than_1, Count, LCD_Time_Span)) %>%mutate(Race=NA)

data2$Race <- ifelse(grepl("Wh",data2$Cause_of_Death), "White", 
                     ifelse(grepl("Bl",data2$Cause_of_Death), "Black", 
                            ifelse(grepl("Ot",data2$Cause_of_Death), "Other", 
                                   ifelse(grepl("Hi",data2$Cause_of_Death), "Hispanic", NA)
                            )
                     )

)

```
But then I noticed that for all states the number of death and the reason spread, so I want to combine them for each state, and calculate the percentage of death reason for each state. Thus, I created a new tibble which contains the state abbreviation, the race , the death reason, the sum of dead children and the percentage that they dead.And I used the double for loops to calculate the sum and the percentage.
```{r}
total<-0
newda<- tibble(CHSI_State_Abbr = state.abb, Race = "White", Cause_of_death = "Preg/Birth Complication",Sum = 0,The_prob_of_death = 0)
for (j in 1:25128) {
  if(data2$Count[[j]] != -1111){
    total <- sum(data2$Count[[j]],total)
  } 
}
total

a<-1
for (i in state.abb) {
  s<- data2%>% filter(CHSI_State_Abbr==i,Cause_of_Death_For_Age_less_than_1 == "A_Wh_Comp")%>%count(n())
  #print(s)
  for (j in 1:s$n[[1]]) {
    if(data2$Count[[j]] != -1111){
      newda$Sum[[a]]<- sum(data2$Count[j],newda$Sum[[a]])
      newda$The_prob_of_death[[a]] <- sum(data2$Count[j],newda$Sum[[a]])/total
     
    } 
  }
 a<- a+1
}
```
After dealing with my final plot data, I uesd geom_col to show the distribution of the percentage of Preg/Birth Complication death for each state.
And from visualization, the highest percentage occurs in CA and the lowest in TX.
```{r}
ggplot(newda,mapping = aes(x = CHSI_State_Abbr, y = The_prob_of_death,fill =CHSI_State_Abbr))+
  geom_col()+
  coord_flip()+
  labs(x = "State Abbreviation", y = "The percentage of death", title = "The percentage of Preg/Birth Complication\n death for children under age one" )
```

## Ryan

## Lauren



# Who Did What

## Chris

## Katie
I modified our main question and the description of our tidied data-set. Adding some specific points and more explanations to the tidy data based on my tidy data. In my individual part, I first gathered all data about dead children under age one, and selected columns for each state. Then in order to show the percentage for each state, I calculated the number of children doe to same death reason and divided by the total number to get the percentage. Because the bar chart is obvious to show the percentage, I indicated the numbers into the bar chart.

## Ryan

## Lauren
I outlined our R ddocument, helped write our the "Overall Question" section, and assisted in the "Description of the Dataset" section. 
When tidying the data, I knew the most imporatnt function I needed to use was gather(). Using the pipe, I gathered each of the causes of death into a Cause_of_Death column and a Count column. I then realized that we really did not need the confidence intervals that were associated with each cause of death, so I used select() within the pipe so my data would only include the following attributes: HSI_County_Name, CHSI_State_Name, CHSI_State_Abbr, Cause_of_Death, Count, and LCD_Time_Span. I made this decision because our overall question, and my individual question, did not require these attributes.
Race and Age Range were hidden within the Cause_of_Death attributes. I knew these were attributes and a tidy dataset has a column for each attribute. I used mutate to establish a Race attribute and an Age Range attribute both filled with NA values. I decided the easiest way for me to extract the race and age data from Cause_of_Death was to use the ifelse() function with grepl() function in order to compare a substring to the Cause_of_Death string. For example, an original observation for cause of death was A_Wh_BirthDef. I wrote the code so it would identify pieces of that observation. If the string contains "A_", then change the associated age range to "under 1". If the string contains "Wh", change the associated race to "White". Finally, if the string contains "BirthDef", change Cause_of_Death to "Birth Defect".
When checking my work, considering ranges and listing the unqiue observations for each attribute, I noticed several negative values within count. I assumed all of these to be missing values since you can not have less than zero people dying. I again used the conditional statement ifelse() to change all values of Count less than zero to be NA.
After each of these steps, the data set was finally tidy with 8 variables and 238,716 observations, as opposed to the original 235 bariables with 3,141 observations.