---
title: "Lab10"
author: "Lauren Gregg, Katie Jiang, Ryan Marizza, Chris He"
date: "3/23/2018"
output: html_document
---


```{r setup, include=FALSE}
library(tidyverse)
library(stringr)

rm(list=ls()) # clears your environment variables
answers<-read_csv("Answers_trunc.csv")
questions<-read_csv("Questions_trunc.csv")


```
# Team Main Questions
What is the relationship between the timeliness of an answer and its score?
And what kinds of features affect the good questions and answers most?

# Team Work

```{r}
QnA<-left_join(questions,answers,by = c('Id'='ParentId'))

QnA<-QnA%>%mutate(time_to_answer = as.numeric(difftime(CreationDate.y, CreationDate.x,units = "mins")))#this gives the time to answer in seconds

QnA<-QnA%>%filter(CreationDate.x<CreationDate.y)%>%group_by(Id)%>%mutate(rank = row_number(time_to_answer))#here's where answers are ranked by their time to answer

QnA_rank<-QnA%>%group_by(rank)%>%summarise(sc = mean(Score.y))

ggplot(data = QnA_rank)+
  geom_point(aes(x = rank,y = sc))+
  geom_smooth(aes(x = rank,y=sc),method = lm,se=FALSE)
#Maybe this isnt the best way to judge timliness (seems more like relative timliness)
```
 The plot above shows the relationship (or lack of relationship) between the timliness of a response, and its score. Timliness here is given as the order in which the answer appeared. That is: the chronologically first answer gets a rank of 1, the second 2, and so on. It seems, from this plot, that the rank, in this sense, of the answer has little to no effect on the score.
 
```{r}
ggplot(data = QnA)+
  geom_point(aes(x = time_to_answer,y = Score.y))
```

```{r}
QnA_short_term<-QnA%>%filter(time_to_answer < 60*5,Score.y<4000)

ggplot(data = QnA_short_term)+
  geom_point(aes(x = time_to_answer,y = Score.y))

```
These two plots show the relationship between score and time to answer. These plots show a different relationship between timliness and the score than the first plot. I would guess that this is because in the "ordered" ranking method of timliness, timliness is viewed as timliness compared to other answerers. This means that an answer with rank = 20 may have been submitted only 25 minutes after the question (given that 19 answers were submitted less than 25 minutes after the question). It seems that timliness does indeed have an effect on score, but the important thing is the literal time it took after the question before the answer was posted, and not the chronological rank of the answer's timliness.
 
Another significant factor in a question/answer's score is the amount of words used.
```{r}

questions<- questions%>%mutate(length = str_length(Title))

ggplot(data = questions)+
  geom_point(aes(x = length,y=Score))

```
This plot shows the relationship between a question's score and the length of the title. It seems like the highest rated titles are not extremely long, and not extremely short, lying somewhere in the 40-60 character range.

```{r}
answers<- answers%>%mutate(yous = str_count(Body,"you"))%>%mutate(length = str_length(Body))%>%filter(length<5000)


ggplot(data = answers)+
  geom_point(aes(x = length,y=Score))



```
It seems again as if there is an optimal range for an answer's length. Upon inspection of the above plot, for the best score, an answer should be in the 500 character range. 



## Explanation of why these features affect most
It seems from the above plots that literal timliness has a huge effect on score. This is likley because after a certain amount of time, the question is forgotten, answered, or solved by the questioner. Therefore, it makes sense that an answer posted soon after the question would recieve a higher score than one posted later. 

The relationship between question/answer length and score is likley explained by the obvious merit of brevity. People don't want to read tons of writing before they can get their answer, or start to answer a question. Therefore, those questions/answers which get their point across in the fewest characters (while still getting their point across) are likley to get the best score.

# Individual Work

## Lauren

As I have learned in my statistical collaboration course, building a relationship can help with successful collabortaion. I was interested if this translated similarly online. I thought politeness was a key factor in a strong relationship, so I was interested if manners impacted the score of questions. I identified manners as please or thank you.

```{r}
LGanswers <- answers %>% select(-X7)
LGquestions <- questions %>% select(-X7)


manners = c("thanks", "thx", "Thank you", "Thanks", "please", "Please", "pls", "plz", "Plz")

LGquestions$Manners = str_detect(LGquestions$Body, manners)

ggplot(LGquestions) + 
  geom_boxplot(aes(Manners, Score))
```

As we can see from the above boxplots, saying please or thank you in an online platform is not correlated with a higher score. This does make sense because a question is probably upvoted for its content, not its politeness.

Next, I considered the answer data. I figured, most of these posters are probably wanting to gather as much information as possible. I was interested to see if including a webpage reference in the answer would have a higher number of votes.

```{r}
LGanswers$Reference = str_detect(LGanswers$Body, "href")

ggplot(LGanswers) +
  geom_boxplot(aes(Reference, Score))

```

There is not a huge disparity between these two data. We see that the outlier with over 8000 votes did include a reference, but it is hard to tell if a true difference exists.

```{r}

trueData <- LGanswers %>% filter(LGanswers$Reference == TRUE) 
falseData <- LGanswers %>% filter(LGanswers$Reference == FALSE)

t.test(trueData$Score, falseData$Score)
```


When computing a quick t-test, we can see that there is a significant difference between the scores when a reference is used and when a references is not used. This leads me to believe that referencing a link with more information on the topic could result in a higher score.


## Kaite
For the questions and answers, I am interested in the high range score, which words have the high numbers of appearance. I created two features which are all about the highest frequency words showing in high score questions and answers. Because the good quality of answers and questions needs some words that make them popular in readers.
```{r}
Question<- questions %>% select(OwnerUserId,Score,Title)
Answers<- answers %>% select(OwnerUserId,Score,Body)
newQ<-tibble(id = Question$OwnerUserId, Score = Question$Score, Title = Question$Title)
iduser <- as.integer(newQ$id)
Score1 <- as.integer(newQ$Score)
title1<- as.character(newQ$Title)
newQ1 <- tibble(iduser = iduser,Score1 = Score1, title1 = title1)
nQ <- newQ1 %>% arrange(desc(Score1))
nQ <- nQ %>% filter(Score1 >= 1000 & Score1 <= 1040)
python <- sum(str_count(nQ$title1,"p|Python+"))
Function<- sum(str_count(nQ$title1,"function+"))
HowandWhat <- sum(str_count(nQ$title1,"^H|how|W|what"))
implement<- sum(str_count(nQ$title1,"I|implement(?=p|Python)"))
String<- sum(str_count(nQ$title1,"p|python(?= function|string)"))
plotQ<- tibble(Highfrequencynames = c("python","function","how and what","implement python","string"),frequency = c(python,Function,HowandWhat,implement,String))

ggplot(plotQ)+
  geom_col(mapping = aes(x= Highfrequencynames, y = frequency,fill = Highfrequencynames))+
  labs(x = "High Frequency Words", y = "Frequency",title = "The highest freqency words appear in score range is between 1000 to 1040\n in good questions")
```
In question part, during the high range of scores, we can see the words python appearing lots of times, which means most readers like the python questions and they also have trouble in solving python questions.
```{r}
newA<- tibble(id = as.integer(answers$OwnerUserId), Score = as.integer(answers$Score), Body = as.character(answers$Body))
nA<- newA %>% arrange(desc(Score))
nA <- nA %>% filter(Score >= 1000 & Score <= 8384)
Python1<- sum(str_count(nA$Body, "p|Python"))
Could <- sum(str_count(nA$Body,"y|You(?= could|are)"))
If_please <- sum(str_count(nA$Body,"^i|If|p|Please"))
Suggest<- sum(str_count(nA$Body,"suggestion|suggest|p|Print"))
comp<- sum(str_count(nA$Body,"M|mac|computer"))
plotA<- tibble(Highfrequencynames = c("Python","Could","If_Please","suggest","computer"),Freq = c(Python1,Could,If_please,Suggest,comp))
ggplot(plotA)+
  geom_col(mapping = aes(x =Highfrequencynames, y = Freq,fill = Highfrequencynames ))+
  labs(x = "High Frequency Words", y = "Frequency",title = "The higest freqency words appear in score range is between 1000 to 8384 \nin good answers")

```
In the answers part, I found the highest one is python, obviously. But then the second followed by "If.. please" and suggestions. So the good way to contribute answers is first including critical words, and using imperative mood to express their answers. In this way, readers will be more comfortable to take actions.

## Ryan

```{r}
#For Questions: I wanted to know if there was a relationship between the length of a question and its score

questions<- questions%>%mutate(length = str_length(Title))

ggplot(data = questions)+
  geom_point(aes(x = length,y=Score))

```
In the questions data, I was interested in whether or not there was a relationship between the length of the title of someone's question, and the score that the question got. It seems like questions with a medium length (about 50 words) did better than short questions or long questions. This is as expected, because brevity is important for clarity in your question, but being too brief can lead to muddled understanding of what you want to know.

```{r}
answers<- answers%>%mutate(yous = str_count(Body,"you"))%>%mutate(length = str_length(Body))


ggplot(data = answers)+
  geom_point(aes(x = length,y=Score))



```

```{r}
answers<- answers%>%mutate(yous = str_count(Body,"you"))%>%mutate(length = str_length(Body))


ggplot(data = answers)+
  geom_point(aes(x = length,y=Score))



```
Here, i wanted to know if there was a relationship between how many times the answerer used the work 'you' and their score. The distribution of yous vs. score looks approximatley the same as the distribution of words vs. score. This tells me that there is no significant relationship between the number of yous used and the score.


## Chris
for this question files, I was consider in like two subject names in our question title and the answes body. So, I mutate the question "I" in the answer.csv body.

```{r}
questions<-questions %>% mutate(I=str_count(questions$Title,"I"))
ggplot(data=questions,aes(x=I,y=Score))+geom_point()
ggplot(data=questions,aes(x=I,y=Score))+geom_point()+geom_boxplot()
ggplot(data=questions,aes(x=I,y=Score))+geom_point()+geom_boxplot(aes(group=cut_width(I,0.25),color=Score))

ggplot(data=questions,aes(x=I,y=Score,color=I))+geom_point()+facet_wrap(~I)
```
then I made the ggplot function for the question I was conisder like why the Geom_boxplot function doesnot show up in my expect way, so I use the group=cut_width but it seems not good, then I used the facet_wrap, when we saw the graph I could see that if a person use less "I" in their title they could get a relative high score in the end, but when we saw the boxplot function we could know there is no relation between this two variable cause the density was in the below.

```{r}
answers<-answers %>% mutate(I2=str_count(answers$Body,"I"))
ggplot(data=answers,mapping=aes(x=I2,y=Score,color=I2))+geom_point()+facet_wrap(~I2)


ggplot(data=answers,mapping=aes(x=I2,y=Score,color=I2))+geom_point()
```
then I was thinking if we answer one person question, the best way or the best suggestion is kind of this form : "I need/I could/ I can", so I was mutate the number of "I" in our answer body. same stituation happened, the geom_boxplot function have some warning, and I dont know how to fixed it, so I just use facet_wrap and geom_point. facet_wrap have really high range so I just consider the geom_point plot. It is easy to conclude that if you use less word like"I", it might receice a higher grades.



# Summary of Who did What

## Lauren
I formatted our final lab document and explained our team results. I also answered questions regarding manners and references. Both required me to use str_detect() and to create a new variable in the data set. I chose to use boxplots for both the question and answer data set because we are concerned with earning a high score on the posts. I also ran a t-test on the answer data to determine if the difference between using a reference and not was significant


## Kaite
I outlined the team questions and modified it. The features that I created are all about the high frequency words appearing in both questions and answers. I narrowed down the range of the scores, and looked for specific words showing in the body of each question and answer. I used str_count to find how many words that contain the same words, and plot them in the certain high range of scores.

## Ryan
I created the code for the team question on timliness vs. score. I also looked at the relationship between length of the title, and score, and the number of yous used in the answer and score. I also wrote the explination section in the team portion.

## Chris
I did two of my own question is there any relationship when we used subject word like "I"" in the question and answer, I the conclusion is that to receive higher score, everybody need to use less subject which means the sentence need be more simple and clear to understand, then you could receice a higher score.
