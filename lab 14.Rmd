---
title: "Lab 14"
author: "Lauren, Ryan, Katie, Chris"
date: "4/26/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(modelr)
library(purrr)
babies <- read_csv("https://raw.githubusercontent.com/ervance1/Sp2018-Data-Science-repo/master/babies2a.dat")
babies <- rename(babies, bwtoz = `bwt/oz`) #renaming `bwt/oz` because the "/" sign requires special care

babies1 <- na.omit(babies)
```

# Overall Question
1. Does Smoking Lead to Babies Born Prematurely?
2. Does Smoking lead to Babies with Low Birth Weight?

## Why it is interesting?
 Generally speaking, smoking is harmful to our body. But in society, a lot of people still smoke and the tendency for women to smoke during preagnancy is increasing, which may have some negative effect on next generation. Babies are significant in a family, and also important for our future, thus in order to figure out what kind of effect of smoking will lead to on both mothers and babies, we analyzed whether smoking leads to babies born prematurely and whether smoking lead to babies with low birth weight. These results will give us solid insight on smoking's effects on babies and mothers. 
## What new tools that we applied?

## The new answers comparing to previous lab

# Conclusion

# Individual Findings

## Lauren 
### Subquestion


## Katie
### Subquestion
Does short gestation days causes light babies weight based on smoking and nonsmoking?
#### why it is important?
Because the short gestation days may lead light babies weight directly, and I think it is an important part for answering our overall questions.And generally speaking, we all think it will cause light weight, but is there a real relationship between them ? I want to explore it more deeply.

#### New tool I used
In order to find the relationship between gestation days and the babies weight, I build a new model which is linear relationship of log gestation days with log weight. Because taking log will make our data more clear and easier to see the tendency. And I add predictions and residuals to see the difference between model and the real data.
```{r}
babies1 <- babies1 %>% filter(gestation <= 270) %>% 
  mutate(lweight = log(bwtoz),lges= log(gestation)) %>% select(gestation,bwtoz,lweight,lges,number,smoke) 

ggplot(babies1,aes(lges,lweight))+
  geom_hex(bins = 50)+
  geom_smooth(method = "loess")+
  facet_wrap(~smoke)+
  ggtitle("Tendency of gestation days with weight")

model_babies1 <-lm(lweight~lges,data = babies1)
```
I use data_grid to create a model data for gestation days and babies weight, and put the estimated one with the real data together.

```{r}
grid <- babies1 %>% 
  data_grid(gestation = seq_range(gestation,270))%>%
  mutate(lges = log2(gestation))%>%
  add_predictions(model_babies1,"lweight")%>%
  mutate(bwtoz = 2^lweight)


ggplot(babies1, aes(gestation,bwtoz )) + 
  geom_hex(bins = 50) + 
  geom_line(data = grid, colour = "red", size = 1)+
  facet_wrap(~smoke)+
  ggtitle("Linear model with real data")

```
We can see from the plot above, there are lots of babies weight above the linear model for nonsmoking one, and more points are below for smoking group. And the majority of points are lying much more above in nonsmoking than smoking group.

```{r}
babies1 <- babies1 %>%
  add_residuals(model_babies1,"lreids")
ggplot(babies1,aes(lweight,lreids))+
  geom_hex(bins = 50)+
  geom_smooth(method = "loess")+
  ggtitle("residuals with lweight data")
ggplot(babies1, aes(as.character(gestation), lreids)) + geom_boxplot()+
  coord_flip()+
  facet_wrap(~smoke)+
  ggtitle("Smoke vs. Nonsmoke the residuals of gestation days")
```
Because there are many points above the linear model, so I looked at the residuals for the weight. In the first graph, there is a tendency of residuals along with weight. After that, I plot the blox plot of residuals and gestation days. The residuals for nonsmoking are larger than the smoking one, and that is what we are expected.
Thus the final answer is that the short gestation days affect babies weight, especially for smoking mothers. And it is an important part of our overall question, because smoking may affect the gestation days, which will cause permature, and that have the relation with babies weight.

## Ryan
### Subquestion


## Chris
### Subquestion


## Contributions
### Lauren 


### Katie
I outlined the lab14, and put overall questions and the importance part.Then I modified my original individual question and answered it by creating model of gestation days with babies weight.In the model, I created a data_grid to simulate the real data and put them together to observe the residuals and the predictions.


### Chris


### Ryan